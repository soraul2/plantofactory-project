version: '3.8'

services:
  # ë°±ì—”ë“œ ì„œë¹„ìŠ¤ (Spring Boot)
  backend:
    # build ê²½ë¡œë¥¼ ìƒˆ í´ë” ì£¼ì†Œë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
    build: ./backend
    ports:
      - "8080:8080"
    environment:
      # application.propertiesì˜ ê¸°ë³¸ê°’ì„ ì•„ë˜ ê°’ë“¤ë¡œ ë®ì–´ì”ë‹ˆë‹¤.
      - spring.datasource.url=${DB_URL}
      - spring.datasource.username=${DB_USER}
      - spring.datasource.password=${DB_PASS}
      - TZ=Asia/Seoul
      - spring.jpa.properties.hibernate.jdbc.time_zone=Asia/Seoul 
      # ğŸ‘† ì´ ë‘ ì„¤ì •ì´ ì»¨í…Œì´ë„ˆì™€ Spring/JPA ì‹œê°„ì„ KSTë¡œ ë§ì¶¥ë‹ˆë‹¤.
    volumes:
    # [ì¶”ê°€] í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ .env íŒŒì¼ì„ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ /app/.env ê²½ë¡œì— ì£¼ì…í•©ë‹ˆë‹¤.
      - ./.env:/app/.env
    depends_on:
      - db
    networks:
      - plantofactory-net

  # í”„ë¡ íŠ¸ì—”ë“œ ì„œë¹„ìŠ¤ (React)
  frontend:
    # build ê²½ë¡œë¥¼ ìƒˆ í´ë” ì£¼ì†Œë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
    build: ./frontend
    ports:
      - "3000:3000"
    depends_on:
      - backend
    networks:
      - plantofactory-net

  db:
    image: mariadb:10.6
    environment:
      - MARIADB_DATABASE=mydatabase
      - MARIADB_USER=myuser
      - MARIADB_PASSWORD=mypassword
      - MARIADB_ROOT_PASSWORD=rootpassword
    volumes:
      - db-data:/var/lib/mysql
    networks:
      - plantofactory-net

  # ----------------------------------
  # ğŸ‘‡ íŒŒì¼ì˜ ìµœí•˜ë‹¨ì— 'volumes' ì„¹ì…˜ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
volumes: 
  db-data: 

networks:
  plantofactory-net:
    driver: bridge
 