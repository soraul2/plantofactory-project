version: '3.8'

services:
  # 백엔드 서비스 (Spring Boot)
  backend:
    # build 경로를 새 폴더 주소로 변경합니다.
    build: ./backend
    ports:
      - "8080:8080"
    environment:
      # application.properties의 기본값을 아래 값들로 덮어씁니다.
      - spring.datasource.url=${DB_URL}
      - spring.datasource.username=${DB_USER}
      - spring.datasource.password=${DB_PASS}
      - TZ=Asia/Seoul
      - spring.jpa.properties.hibernate.jdbc.time_zone=Asia/Seoul 
      # 👆 이 두 설정이 컨테이너와 Spring/JPA 시간을 KST로 맞춥니다.
    volumes:
    # [추가] 프로젝트 루트의 .env 파일을 컨테이너 내부의 /app/.env 경로에 주입합니다.
      - ./.env:/app/.env
    depends_on:
      - db
    networks:
      - plantofactory-net

  # 프론트엔드 서비스 (React)
  frontend:
    # build 경로를 새 폴더 주소로 변경합니다.
    build: ./frontend
    ports:
      - "3000:3000"
    depends_on:
      - backend
    networks:
      - plantofactory-net

  db:
    image: mariadb:10.6
    environment:
      - MARIADB_DATABASE=mydatabase
      - MARIADB_USER=myuser
      - MARIADB_PASSWORD=mypassword
      - MARIADB_ROOT_PASSWORD=rootpassword
    volumes:
      - db-data:/var/lib/mysql
    networks:
      - plantofactory-net

  # ----------------------------------
  # 👇 파일의 최하단에 'volumes' 섹션을 추가합니다.
volumes: 
  db-data: 

networks:
  plantofactory-net:
    driver: bridge
 